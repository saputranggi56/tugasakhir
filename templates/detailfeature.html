{% extends "layout.html" %}
{% block content %}
<style>
  a.m_title {
    text-transform: uppercase;
  }

  .a_middle{
    vertical-align:middle!important;
  }

</style>
<h4>
    DETAIL DATA FEATURE "<a class="m_title">{{sentence}}</a>"
</h4>
<div class="card mb-2">

  <div class="card-body">
    <div class="row">

      <div class="col-md-4">
        <div class="form-group">
            <select class="form-control" name="portal_select" id="portal_select">
              <option value="all"   {% if p_portal == 'all' %} selected {% endif %}>All News Portal </option>
              <option value="TEMPO" {% if p_portal == 'TEMPO' %} selected {% endif %}>Tempo</option>
              <option value="DETIK" {% if p_portal == 'DETIK' %} selected {% endif %}>Detik</option>
              <option value="PR"    {% if p_portal == 'PR' %}selected {% endif %}>PR</option>
              <option value="CNBC"  {% if p_portal == 'CNBC' %}selected {% endif %}>CNBC</option>
            </select>
        </div>
      </div>
      <div class="col-md-4">
        <div class="form-group">
            <select class="form-control" name="class_select" id="class_select">
              <option value="all"   {% if p_class == 'all' %} selected {% endif %}>All Class</option>
              <option value="1"     {% if p_class == '1' %} selected {% endif %}>Positif</option>
              <option value="2"     {% if p_class == '2' %} selected {% endif %}>Negatif</option>
              <option value="0"     {% if p_class == '0' %}selected {% endif %}>Netral</option>
            </select>
        </div>
      </div>
      <div class="col-md-2">
        <button class="btn btn-info btn-block btn-search" >Search</button>
      </div>
    </div>
  </div>
 
</div>
<div class="alert alert-info alert-dismissable">
  <a href="#" class="close" data-dismiss="alert" aria-label="close">Ã—</a>
  <strong>Displays the features contained in the sentence <span class="text-danger">'{{sentence}}'<span>  </strong>
</div>


<div class="card">
  <div class="card-body">
    <div class="table-responsive">
      <table class="table table-bordered" id="example"></table>
    </div>
  </div>
</div>


<script>
  $(document).ready( function () {
    function myFunc(vars) {
      return vars
    }
    myVar = myFunc({{data|tojson}})
    baseUrl   = '{{baseUrl}}'
    
    $('.btn-search').on('click', function(){
      portal = $('#portal_select').val()
      class_select = $('#class_select').val()
      
      window.location.href = baseUrl+'/feature?sentence='+'{{sentence}}'+'&portal='+portal+'&class='+class_select;

    })


    var data = myVar
    var table = $('#example').DataTable({
      columns: [
          {   
            name: 'url',
            title: 'No',
          },
          {
            name: 'portal',
            title: 'Portal',
          },
          {
            name: 'judul',
            title: 'Title',
          },
          {   
            name:'kalimat',
            title: 'Sentence After Preporcessing',
          },
          {   
            name:'flagging',
            title: 'Class',
          },
          {   
            name:'action',
            title: 'Action',
          }
      ],
      data: data,
      rowsGroup: [
        'portal:name',
        'judul:name',
        'action:name'
      ],
      lengthMenu  : [[100, 200, 300, -1], [100, 200, 300, "All"]],
      pageLength: '100',
      columnDefs :[
        {
            width: '20px',
            targets: 0,
            visible: false
        },
        {
            width: '10px',
            targets: 1,
            visible: true
        },
        {
            width: '150px',
            targets: 2,
            visible: true
        },
        {
          "mRender": function ( data, type, row ) {

              $rowdata = data.split(' ').map(function(cell, i){
                if(cell == '{{sentence}}'){
                  cell = '<span class="text-danger">'+cell+'</span>'
                }
                return cell
              }).join(' ');

              return $rowdata;
          },
          targets: 3,
          visible: true
        },
        {
          "mRender": function ( data, type, row ) {
              $rowdata = ''
              if(data == '0'){
                $rowdata = '<span class="badge badge-info">Netral</span>'
              }else if(data == '1'){
                $rowdata = '<span class="badge badge-primary">Positive</span>'

              }else if(data == '2'){
                $rowdata = '<span class="badge badge-danger">Negative</span>'

              }

              return $rowdata;
          },
          targets: 4,
          visible: true
        },
        {
          "mRender": function ( data, type, row ) {
              $rowdata = '<button class="btn btn-info" onClick="detailberita(\''+data+'\')">Detail News</button>'

              return $rowdata;
          },
          "className" : "a_middle",
          "aTargets": [ 5 ]
        },
      ]
    });
  
    
  })

  function detailberita(berita_id){
    location.href = baseUrl+'/'+'detailBerita'+'?berita='+berita_id
  }
</script>
{% endblock %}